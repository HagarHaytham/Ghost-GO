/*!
 * @pixi/prepare - v5.1.5
 * Compiled Tue, 24 Sep 2019 04:07:05 UTC
 *
 * @pixi/prepare is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
this.PIXI=this.PIXI||{},this.PIXI.prepare=this.PIXI.prepare||{};var _pixi_prepare=function(t,e,i,r,s,o,n){"use strict";e.settings.UPLOADS_PER_FRAME=4;var u=function(t){this.maxItemsPerFrame=t,this.itemsLeft=0};u.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},u.prototype.allowedToUpload=function(){return this.itemsLeft-- >0};var h=function(t){var i=this;this.limiter=new u(e.settings.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){i.queue&&i.prepareItems()},this.registerFindHook(f),this.registerFindHook(k),this.registerFindHook(a),this.registerFindHook(p),this.registerFindHook(l),this.registerUploadHook(c),this.registerUploadHook(d)};function a(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var s=0;s<t._textures.length;s++)if(t._textures[s]instanceof i.Texture){var o=t._textures[s].baseTexture;-1===e.indexOf(o)&&(e.push(o),r=!0)}return r}function p(t,e){return t instanceof i.BaseTexture&&(-1===e.indexOf(t)&&e.push(t),!0)}function l(t,e){if(t._texture&&t._texture instanceof i.Texture){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function c(t,e){return e instanceof n.Text&&(e.updateText(!0),!0)}function d(t,e){if(e instanceof n.TextStyle){var i=e.toFontString();return n.TextMetrics.measureFont(i),!0}return!1}function f(t,e){if(t instanceof n.Text){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function k(t,e){return t instanceof n.TextStyle&&(-1===e.indexOf(t)&&e.push(t),!0)}h.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,s.Ticker.system.addOnce(this.tick,this,s.UPDATE_PRIORITY.UTILITY))):e&&e()},h.prototype.tick=function(){setTimeout(this.delayedTick,0)},h.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)s.Ticker.system.addOnce(this.tick,this,s.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(var n=0,u=o.length;n<u;n++)o[n]()}},h.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},h.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},h.prototype.add=function(t){for(var e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof o.Container)for(var r=t.children.length-1;r>=0;r--)this.add(t.children[r]);return this},h.prototype.destroy=function(){this.ticking&&s.Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var g=function(t){function e(e){t.call(this,e),this.uploadHookHelper=this.renderer,this.registerFindHook(I),this.registerUploadHook(m),this.registerUploadHook(x)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(h);function m(t,e){return e instanceof i.BaseTexture&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function x(t,e){return e instanceof r.Graphics&&((e.dirty||e.clearDirty||!e._webGL[t.plugins.graphics.CONTEXT_UID])&&t.plugins.graphics.updateGraphics(e),!0)}function I(t,e){return t instanceof r.Graphics&&(e.push(t),!0)}var T=function(t){this.maxMilliseconds=t,this.frameStart=0};return T.prototype.beginFrame=function(){this.frameStart=Date.now()},T.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t.BasePrepare=h,t.CountLimiter=u,t.Prepare=g,t.TimeLimiter=T,t}({},PIXI,PIXI,PIXI,PIXI,PIXI,PIXI);Object.assign(this.PIXI.prepare,_pixi_prepare);
//# sourceMappingURL=prepare.min.js.map
